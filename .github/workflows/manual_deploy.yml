name: manual deploy
run-name: Deploy to ${{ inputs.service }} on ${{ github.ref_name }} branch by @${{ github.actor }}
on:
  workflow_dispatch:
    inputs:
      service:
        description: 'service name'
        required: true
        default: 'harrods'
        type: choice
        options:
          - harrods
          - stat
jobs:
  setup_environment:
    name: setup environment
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - id: set_env
        name: Set Env Variables
        run: |
          echo "ecr_repo=${{ inputs.env }}_${{ inputs.service }}_ECR_REPO" >> $GITHUB_ENV
          echo "project=${{ inputs.env }}_${{ inputs.service }}_PROJECT" >> $GITHUB_ENV
          echo "dockerfile=${{ inputs.env }}_${{ inputs.service }}_DOCKERFILE" >> $GITHUB_ENV
          echo "${{ env.ecr_repo }}, ${{ env.project }}, ${{ env.dockerfile }}"

  build:
    name: second job
    runs-on: ubuntu-22.04
    needs: [ setup_environment ] # first_job을 실행하고 second_job을 실행하도록 한다
    steps:
      - run: echo 'second job'
